# Шпаргалка команд
## Установить заголовки для разработки в пространстве ядра
```
sudo apt install build-essential linux-headers-$(uname -r)
```

## Инструменты для анализа скомпилированного модуля
###
```
file your_module.ko
```

###
```
modinfo your_module.ko
```

###
```
nm your_module.ko
```

###
```
objdump -h your_module.ko
```

###
```
readelf -s your_module.ko
readelf -s your_module.ko | grep FUNC
readelf -s your_module.ko | grep __UNIQUE
```

## Вкл/выкл модуля и наблюдение за работой
### Подключить к ядру
```
sudo insmod your_module.ko
```

### Отключить от ядра
```
sudo rmmod your_module
```

### Убедиться, что подключён (найти в списке подключённых)
```
lsmod | grep your_module
```

## Логирование
### Наблюдаем за логами ядра
```
tail -f /var/log/kern.log
```

### Наблюдаем за теми же логами ядра чуть иначе
```
dmesg -w
```

### Выясняем установленные уровни логирования
```
cat /proc/sys/kernel/printk
```

### Меняем уровень, с которого идёт запись в логи
```
echo 8 | sudo tee /proc/sys/kernel/printk
```

## Имена устройств
### Зарегистрированные имена устройств
```
ls -l /dev/
```

### Группы устройств
```
cat /proc/devices
```

### Зарегистрировать имя устройства
```
sudo mknod -m0666 /dev/[имя устройства] c [major] [minor]
```

### Удалить имя устройства
```
sudo rm /dev/[имя устройства]
```

## Список параметров модуля
```
ls /sys/module/[имя модуля]/parameters/
```

## Динамическая регистрация имени устройства

### Мониторинг сообщений в систему udev
```
udevadm monitor --property
```

### Узнать кое-что о модуле с точки зрения udev
```
udevadm info --path=/module/[имя модуля] --export
```

## Как приложения используют ядро
### Какие динамические библиотеки использует приложение
```
ldd ./[исполняемый файл]
```

### Какие системные вызовы в какой последовательности использует приложение
```
strace ./[исполняемый файл]
```
